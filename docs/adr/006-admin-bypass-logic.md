# ADR 006: 管理者向け位置情報バリデーションバイパスロジック

## ステータス
承認済み (Accepted)

## コンテキスト
本アプリケーションは彦根市（日本）を対象とした位置情報依存サービス（ジオフェンシングを用いたスタンプラリー）である。
しかし、開発拠点が海外（ドイツ）にあるため、物理的な位置情報の制約により、スタンプ付与機能の実機テストが不可能となっている。
位置情報を偽装する方法もあるが、デバイスや環境に依存せず、かつ安全にテストを行うためのサーバーサイドでの回避策が必要とされた。

## 決定事項
特定の管理者アカウント（`sepa1224@gmail.com`）に対して、スタンプ付与時の位置情報（距離）チェックを無条件で通過させるロジックを実装する。

### 実装詳細
- `lib/actions/stamp.ts` の `grantStamp` 関数内において、認証ユーザーのメールアドレスを確認する。
- メールアドレスが `sepa1224@gmail.com` と一致する場合、店舗とユーザーの距離が50mを超えていてもエラーとせず、処理を続行する。

## 結果
### メリット
- 海外拠点からでも、本番相当のサーバーロジックを用いてスタンプ付与のテストが可能になる。
- クライアントサイドでの位置情報偽装（Mock Location）などの複雑な設定が不要になる。

### デメリット/リスク
- コード内に特定のメールアドレスがハードコーディングされるため、セキュリティ上の懸念（軽微だが）がある。
- 本番環境でこのアドレスを使用するユーザーがいる場合、位置情報制限が効かなくなる（現状は開発者のみのため許容）。

## 将来の展望
本番リリース時またはフェーズが進んだ段階で、以下のいずれかの方法へ移行する。
1. **環境変数化**: バイパス許可メールアドレスを `ADMIN_EMAILS` などの環境変数で管理する。
2. **ロールベース制御**: DB上の `profiles.role` や `is_admin` フラグを参照して判断する。
3. **削除**: ローンチ後は不要となる可能性があるため、ロジック自体を削除する。
